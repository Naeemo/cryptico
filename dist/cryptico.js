!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.cryptico=e()}(this,function(){"use strict";var t={};t.Sbox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],t.ShiftRowTab=[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11],t.Init=function(){var e;for(t.Sbox_Inv=new Array(256),e=0;e<256;e++)t.Sbox_Inv[t.Sbox[e]]=e;for(t.ShiftRowTab_Inv=new Array(16),e=0;e<16;e++)t.ShiftRowTab_Inv[t.ShiftRowTab[e]]=e;for(t.xtime=new Array(256),e=0;e<128;e++)t.xtime[e]=e<<1,t.xtime[128+e]=e<<1^27},t.Done=function(){delete t.Sbox_Inv,delete t.ShiftRowTab_Inv,delete t.xtime},t.ExpandKey=function(e){var n,r=e.length,i=1;switch(r){case 16:n=176;break;case 24:n=208;break;case 32:n=240;break;default:alert("my.ExpandKey: Only key lengths of 16, 24 or 32 bytes allowed!")}for(var o=r;o<n;o+=4){var a=e.slice(o-4,o);o%r==0?(a=[t.Sbox[a[1]]^i,t.Sbox[a[2]],t.Sbox[a[3]],t.Sbox[a[0]]],(i<<=1)>=256&&(i^=283)):r>24&&o%r==16&&(a=[t.Sbox[a[0]],t.Sbox[a[1]],t.Sbox[a[2]],t.Sbox[a[3]]]);for(var c=0;c<4;c++)e[o+c]=e[o+c-r]^a[c]}},t.Encrypt=function(e,n){var r=n.length;t.AddRoundKey(e,n.slice(0,16));for(var i=16;i<r-16;i+=16)t.SubBytes(e,t.Sbox),t.ShiftRows(e,t.ShiftRowTab),t.MixColumns(e),t.AddRoundKey(e,n.slice(i,i+16));t.SubBytes(e,t.Sbox),t.ShiftRows(e,t.ShiftRowTab),t.AddRoundKey(e,n.slice(i,r))},t.Decrypt=function(e,n){var r=n.length;t.AddRoundKey(e,n.slice(r-16,r)),t.ShiftRows(e,t.ShiftRowTab_Inv),t.SubBytes(e,t.Sbox_Inv);for(var i=r-32;i>=16;i-=16)t.AddRoundKey(e,n.slice(i,i+16)),t.MixColumns_Inv(e),t.ShiftRows(e,t.ShiftRowTab_Inv),t.SubBytes(e,t.Sbox_Inv);t.AddRoundKey(e,n.slice(0,16))},t.SubBytes=function(t,e){for(var n=0;n<16;n++)t[n]=e[t[n]]},t.AddRoundKey=function(t,e){for(var n=0;n<16;n++)t[n]^=e[n]},t.ShiftRows=function(t,e){for(var n=[].concat(t),r=0;r<16;r++)t[r]=n[e[r]]},t.MixColumns=function(e){for(var n=0;n<16;n+=4){var r=e[n+0],i=e[n+1],o=e[n+2],a=e[n+3],c=r^i^o^a;e[n+0]^=c^t.xtime[r^i],e[n+1]^=c^t.xtime[i^o],e[n+2]^=c^t.xtime[o^a],e[n+3]^=c^t.xtime[a^r]}},t.MixColumns_Inv=function(e){for(var n=0;n<16;n+=4){var r=e[n+0],i=e[n+1],o=e[n+2],a=e[n+3],c=r^i^o^a,u=t.xtime[c],s=t.xtime[t.xtime[u^r^o]]^c,f=t.xtime[t.xtime[u^i^a]]^c;e[n+0]^=s^t.xtime[r^i],e[n+1]^=f^t.xtime[i^o],e[n+2]^=s^t.xtime[o^a],e[n+3]^=f^t.xtime[a^r]}};var e=t,n=e,r={};n.Init();var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";r.b256to64=function(t){var e,n,r,i="",a=0,c=0,u=t.length;for(r=0;r<u;r++)n=t.charCodeAt(r),0==c?(i+=o.charAt(n>>2&63),e=(3&n)<<4):1==c?(i+=o.charAt(e|n>>4&15),e=(15&n)<<2):2==c&&(i+=o.charAt(e|n>>6&3),a+=1,i+=o.charAt(63&n)),a+=1,c+=1,3==c&&(c=0);return c>0&&(i+=o.charAt(e),a+=1,i+="=",a+=1),1==c&&(i+="="),i},r.b64to256=function(t){var e,n,r="",i=0,a=0,c=t.length;for(n=0;n<c;n++)e=o.indexOf(t.charAt(n)),e>=0&&(i&&(r+=String.fromCharCode(a|e>>6-i&255)),i=i+2&7,a=e<<i&255);return r},r.b16to64=function(t){var e,n,r="";for(t.length%2==1&&(t="0"+t),e=0;e+3<=t.length;e+=3)n=parseInt(t.substring(e,e+3),16),r+=o.charAt(n>>6)+o.charAt(63&n);for(e+1==t.length?(n=parseInt(t.substring(e,e+1),16),r+=o.charAt(n<<2)):e+2==t.length&&(n=parseInt(t.substring(e,e+2),16),r+=o.charAt(n>>2)+o.charAt((3&n)<<4));(3&r.length)>0;)r+="=";return r},r.b64to16=function(t){var e,n,r="",i=0;for(e=0;e<t.length&&"="!=t.charAt(e);++e)v=o.indexOf(t.charAt(e)),v<0||(0==i?(r+=int2char(v>>2),n=3&v,i=1):1==i?(r+=int2char(n<<2|v>>4),n=15&v,i=2):2==i?(r+=int2char(n),r+=int2char(v>>2),n=3&v,i=3):(r+=int2char(n<<2|v>>4),r+=int2char(15&v),i=0));return 1==i&&(r+=int2char(n<<2)),r},r.string2bytes=function(t){for(var e=new Array,n=0;n<t.length;n++)e.push(t.charCodeAt(n));return e},r.bytes2string=function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},r.blockXOR=function(t,e){for(var n=new Array(16),r=0;r<16;r++)n[r]=t[r]^e[r];return n},r.blockIV=function(){var t=new SecureRandom,e=new Array(16);return t.nextBytes(e),e},r.pad16=function(t){var e=t.slice(0),n=(16-t.length%16)%16;for(i=t.length;i<t.length+n;i++)e.push(0);return e},r.depad=function(t){for(var e=t.slice(0);0==e[e.length-1];)e=e.slice(0,e.length-1);return e},r.encryptAESCBC=function(t,e){var i=e.slice(0);n.ExpandKey(i);var o=r.string2bytes(t);o=r.pad16(o);for(var a=r.blockIV(),c=0;c<o.length/16;c++){var u=o.slice(16*c,16*c+16),s=a.slice(16*c,16*c+16);u=r.blockXOR(s,u),n.Encrypt(u,i),a=a.concat(u)}var f=r.bytes2string(a);return r.b256to64(f)},r.decryptAESCBC=function(t,e){var i=e.slice(0);n.ExpandKey(i);for(var t=r.b64to256(t),o=r.string2bytes(t),a=[],c=1;c<o.length/16;c++){var u=o.slice(16*c,16*c+16),s=o.slice(16*(c-1),16*(c-1)+16);n.Decrypt(u,i),u=r.blockXOR(s,u),a=a.concat(u)}return a=r.depad(a),r.bytes2string(a)},r.wrap60=function(t){for(var e="",n=0;n<t.length;n++)n%60==0&&0!=n&&(e+="\n"),e+=t[n];return e},r.generateAESKey=function(){var t=new Array(32),e=new SecureRandom;return e.nextBytes(t),t},r.generateRSAKey=function(t,e){Math.seedrandom(sha256.hex(t));var n=new RSAKey;return n.generate(e,"03"),n},r.publicKeyString=function(t){return pubkey=r.b16to64(t.n.toString(16)),pubkey},r.publicKeyID=function(t){return MD5(t)},r.publicKeyFromString=function(t){var e=r.b64to16(t.split("|")[0]),n="03",i=new RSAKey;return i.setPublic(e,n),i},r.encrypt=function(t,e,n){var i="",o=r.generateAESKey();try{var a=r.publicKeyFromString(e);i+=r.b16to64(a.encrypt(r.bytes2string(o)))+"?"}catch(t){return{status:"Invalid public key"}}return n&&(signString=r.b16to64(n.signString(t,"sha256")),t+="::52cee64bb3a38f6403386519a39ac91c::",t+=r.publicKeyString(n),t+="::52cee64bb3a38f6403386519a39ac91c::",t+=signString),i+=r.encryptAESCBC(t,o),{status:"success",cipher:i}},r.decrypt=function(t,e){var n=t.split("?"),i=e.decrypt(r.b64to16(n[0]));if(null==i)return{status:"failure"};i=r.string2bytes(i);var o=r.decryptAESCBC(n[1],i).split("::52cee64bb3a38f6403386519a39ac91c::");if(3==o.length){var a=r.publicKeyFromString(o[1]),c=r.b64to16(o[2]);return a.verifyString(o[0],c)?{status:"success",plaintext:o[0],signature:"verified",publicKeyString:r.publicKeyString(a)}:{status:"success",plaintext:o[0],signature:"forged",publicKeyString:r.publicKeyString(a)}}return{status:"success",plaintext:o[0],signature:"unsigned"}};var a=r;return a});
